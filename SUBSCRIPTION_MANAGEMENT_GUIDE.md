# دليل إدارة الاشتراكات بالتقارير الأونلاين

## نظرة عامة
تم تطوير نظام شامل لإدارة الاشتراكات في ميزة التقارير الأونلاين، والذي يتيح للمدارس شراء وإدارة اشتراكاتها في خدمة رفع التقارير على السحابة.

## المكونات الرئيسية

### 1. شاشة إدارة الاشتراكات (`SubscriptionManagementScreen`)
**المسار:** `lib/admin/subscription_management_screen.dart`

**الميزات:**
- عرض معلومات المؤسسة (اسم المدرسة، معرف المؤسسة)
- عرض حالة الاشتراك الحالية (نشط/غير نشط، نوع الاشتراك، تاريخ الانتهاء)
- إدارة ميزة التقارير الأونلاين:
  - عرض حالة الميزة (مفعلة/غير مفعلة)
  - زر شراء الميزة للمؤسسات غير المشتركة
  - زر اختبار رفع التقارير للمؤسسات المشتركة
- عرض الميزات المشتراة مع تفاصيل الشراء
- أدوات إدارية (تحديث البيانات، تاريخ الاشتراكات، اتصال بالدعم)

### 2. خدمة الميزات المتقدمة (`PremiumFeaturesService`)
**المسار:** `lib/services/premium_features_service.dart`

**الوظائف:**
- تحديد أسعار الميزات (شهري: 25,000 د.ع / سنوي: 250,000 د.ع)
- التحقق من حالة الميزات للمؤسسة
- عرض شاشة شراء الميزة مع خيارات الدفع
- معالجة عمليات الشراء والتفعيل

### 3. لوحة تحكم الإدارة (`AdminDashboardScreen`)
**المسار:** `lib/admin/admin_dashboard_screen.dart`

**المحتوى:**
- إحصائيات النظام (المؤسسات النشطة، الاشتراكات الفعالة)
- روابط سريعة لأدوات الإدارة
- واجهة سهلة الاستخدام للمدراء

### 4. مساعد قوائم الإدارة (`AdminMenuHelper`)
**المسار:** `lib/helpers/admin_menu_helper.dart`

**الوظائف:**
- إدارة قوائم التنقل في قسم الإدارة
- توفير واجهات موحدة للقوائم والبطاقات
- تسهيل التنقل بين الشاشات

## كيفية الوصول للنظام

### من الشاشة الرئيسية:
1. اضغط على "إدارة الاشتراكات" في قائمة الخيارات السريعة
2. سيتم الانتقال مباشرة إلى لوحة تحكم الإدارة
3. من لوحة التحكم، اضغط على "إدارة الاشتراكات" للوصول لتفاصيل الاشتراك

### الوصول المباشر:
- Route: `/admin-dashboard` للوصول إلى لوحة تحكم الإدارة

## سير العمل

### للمؤسسات غير المشتركة:
1. **عرض الحالة:** ستظهر رسالة "غير مفعل" بجانب ميزة التقارير الأونلاين
2. **الشراء:** الضغط على "شراء الميزة" يفتح شاشة الشراء
3. **اختيار الخطة:** اختيار بين الاشتراك الشهري أو السنوي
4. **إتمام الشراء:** معالجة الدفع وتفعيل الميزة

### للمؤسسات المشتركة:
1. **عرض الحالة:** ستظهر علامة "مفعل" بجانب ميزة التقارير الأونلاين
2. **الاختبار:** زر "اختبار الرفع" للتأكد من عمل الخدمة
3. **المتابعة:** عرض تاريخ انتهاء الاشتراك والميزات المتاحة

## الميزات التقنية

### الأمان:
- التحقق من صلاحيات المؤسسة
- تشفير بيانات الدفع
- مصادقة آمنة مع قاعدة البيانات

### الأداء:
- تحميل البيانات بشكل غير متزامن
- إعادة تحديث البيانات عند الحاجة
- واجهات سريعة الاستجابة

### تجربة المستخدم:
- رسائل واضحة للحالات المختلفة
- تصميم متجاوب يدعم الأجهزة المختلفة
- تنقل سهل ومباشر

## قاعدة البيانات

### الجداول المستخدمة:
- `educational_organizations`: معلومات المؤسسات
- `subscriptions`: تفاصيل الاشتراكات
- `feature_purchases`: سجل المشتريات
- `subscription_status_view`: عرض شامل لحالة الاشتراكات

### العمليات:
- `checkOrganizationSubscriptionStatus`: التحقق من حالة الاشتراك
- `purchaseOnlineReportsFeature`: شراء ميزة التقارير
- `getOrganizationPurchasedFeatures`: جلب الميزات المشتراة

## التخصيص والتطوير

### إضافة ميزات جديدة:
1. تحديث `FEATURE_PRICES` في `PremiumFeaturesService`
2. إضافة العمليات المطلوبة في `SupabaseService`
3. تحديث واجهة `SubscriptionManagementScreen`

### تخصيص الأسعار:
- تعديل قيم `price_monthly` و `price_yearly` في `FEATURE_PRICES`
- تحديث العملة إذا لزم الأمر

### إضافة طرق دفع جديدة:
- تطوير معالجات دفع إضافية
- دمج خدمات الدفع الإلكتروني
- تحديث واجهة الشراء

## الدعم والصيانة

### مراقبة النظام:
- تتبع عمليات الشراء والتفعيل
- مراقبة أداء النظام
- تحليل استخدام الميزات

### الدعم الفني:
- معلومات الاتصال متوفرة في شاشة إدارة الاشتراكات
- نظام تذاكر الدعم (قيد التطوير)
- دليل المستخدم التفاعلي

---

تم تطوير هذا النظام ليكون شاملاً وقابلاً للتوسع، مع إمكانية إضافة ميزات جديدة وتخصيص الأسعار حسب احتياجات السوق.
