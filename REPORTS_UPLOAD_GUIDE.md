# ุฏููู ุฑูุน ุงูุชูุงุฑูุฑ ุฅูู Supabase

## ุงููููุงุช ุงููููุดุฃุฉ:

### 1. `reports_table_schema.sql`
- **ุงูุบุฑุถ**: ุฅูุดุงุก ุฌุฏูู ุงูุชูุงุฑูุฑ ูู ูุงุนุฏุฉ ุจูุงูุงุช Supabase
- **ุงููุญุชูู**: 
  - ุฌุฏูู `school_reports` ูุญูุธ ุงูุชูุงุฑูุฑ ุงูุนุงูุฉ
  - ููุงุฑุณ ูุชุญุณูู ุงูุฃุฏุงุก
  - ุชุฑูุฌุฑ ูุชุญุฏูุซ `updated_at` ุชููุงุฆูุงู

### 2. `lib/services/reports_supabase_service.dart`
- **ุงูุบุฑุถ**: ุฎุฏูุฉ ุฅุฏุงุฑุฉ ุงูุชูุงุฑูุฑ ูู Supabase
- **ุงููุธุงุฆู**:
  - `uploadGeneralReport()`: ุฑูุน ุชูุฑูุฑ ุนุงู ุฌุฏูุฏ
  - `getSchoolReports()`: ุฌูุจ ุชูุงุฑูุฑ ูุฏุฑุณุฉ ูุนููุฉ
  - `getOrganizationReports()`: ุฌูุจ ุชูุงุฑูุฑ ูุคุณุณุฉ ูุงููุฉ
  - `deleteReport()`: ุญุฐู ุชูุฑูุฑ
  - `updateReport()`: ุชุญุฏูุซ ุชูุฑูุฑ
  - `getOrganizationStats()`: ุฅุญุตุงุฆูุงุช ุงููุคุณุณุฉ
  - `getAvailableAcademicYears()`: ุงูุณููุงุช ุงูุฏุฑุงุณูุฉ ุงููุชููุฑุฉ

### 3. `lib/reports/uploaded_reports_screen.dart`
- **ุงูุบุฑุถ**: ุดุงุดุฉ ุนุฑุถ ูุฅุฏุงุฑุฉ ุงูุชูุงุฑูุฑ ุงููุฑููุนุฉ
- **ุงููููุฒุงุช**:
  - ุนุฑุถ ูุงุฆูุฉ ุงูุชูุงุฑูุฑ ุงููุฑููุนุฉ
  - ููุชุฑุฉ ุจุงูุณูุฉ ุงูุฏุฑุงุณูุฉ
  - ุนุฑุถ ุชูุงุตูู ูู ุชูุฑูุฑ
  - ุญุฐู ุงูุชูุงุฑูุฑ

### 4. ุชุญุฏูุซุงุช ุนูู `lib/reports/reportsscreen.dart`
- **ุงูุฅุถุงูุงุช**:
  - ุฏุงูุฉ `uploadReportToSupabase()`: ุฑูุน ุงูุชูุฑูุฑ ุงูุญุงูู
  - ุฒุฑ ุฑูุน ุงูุชูุงุฑูุฑ ูู AppBar
  - ุฒุฑ ุนุฑุถ ุงูุชูุงุฑูุฑ ุงููุฑููุนุฉ

## ุฎุทูุงุช ุงูุชูููุฐ:

### 1. ุฅูุดุงุก ุงูุฌุฏูู ูู Supabase:
```sql
-- ูููุฐ ูุญุชูู ููู reports_table_schema.sql ูู Supabase Dashboard
```

### 2. ุชุญุฏูุซ ูุนุฑูุงุช ุงููุคุณุณุฉ ูุงููุฏุฑุณุฉ:
ูู ุงููููุงุช ุงูุชุงููุฉุ ุงุณุชุจุฏู ุงูููู ุงูุซุงุจุชุฉ ุจุงููุนุฑูุงุช ุงูุญููููุฉ:

**ูู `reportsscreen.dart`:**
```dart
// ุงูุณุทุฑ 162 ู 163
const int organizationId = 1; // ุงุณุชุจุฏู ุจุงููุนุฑู ุงูุญูููู
const int schoolId = 1; // ุงุณุชุจุฏู ุจุงููุนุฑู ุงูุญูููู
```

**ูู `reportsscreen.dart`:**
```dart
// ุงูุณุทุฑ 490-492
organizationId: 1, // ุงุณุชุจุฏู ุจุงููุนุฑู ุงูุญูููู  
schoolId: 1, // ุงุณุชุจุฏู ุจุงููุนุฑู ุงูุญูููู ุฃู ุงุชุฑูู null ูุฌููุน ุงููุฏุงุฑุณ
```

### 3. ุฅุถุงูุฉ ูุชุบูุฑุงุช ุนุงูุฉ (ุงุฎุชูุงุฑู):
ููููู ุฅุถุงูุฉ ูุชุบูุฑุงุช ุนุงูุฉ ูู `main.dart`:
```dart
// ุฅุถุงูุฉ ูุฐู ุงููุชุบูุฑุงุช ูู main.dart
int? currentOrganizationId;
int? currentSchoolId;
String? currentUserId;

// ุฏุงูุฉ ูุชุนููู ุงูููู ุนูุฏ ุชุณุฌูู ุงูุฏุฎูู
void setCurrentUserContext(int orgId, int schoolId, String userId) {
  currentOrganizationId = orgId;
  currentSchoolId = schoolId;
  currentUserId = userId;
}
```

### 4. ุงุฎุชุจุงุฑ ุงููุธุงุฆู:

#### ุงุฎุชุจุงุฑ ุฑูุน ุงูุชูุฑูุฑ:
1. ุงูุชุญ ุดุงุดุฉ ุงูุชูุงุฑูุฑ ุงูุนุงูุฉ
2. ุงุฎุชุฑ ุณูุฉ ุฏุฑุงุณูุฉ ุฃู ูุชุฑุฉ ุฒูููุฉ
3. ุงุถุบุท ุนูู ุฒุฑ "ุฑูุน ุงูุชูุฑูุฑ ุฅูู ุงูุณุญุงุจุฉ" (โ๏ธโฌ๏ธ)
4. ุชุฃูุฏ ูู ุธููุฑ ุฑุณุงูุฉ ุงููุฌุงุญ

#### ุงุฎุชุจุงุฑ ุนุฑุถ ุงูุชูุงุฑูุฑ ุงููุฑููุนุฉ:
1. ุงุถุบุท ุนูู ุฒุฑ "ุนุฑุถ ุงูุชูุงุฑูุฑ ุงููุฑููุนุฉ" (โ๏ธโฌ๏ธ)
2. ุชุฃูุฏ ูู ุธููุฑ ุงูุชูุงุฑูุฑ ุงููุฑููุนุฉ
3. ุฌุฑูุจ ููุชุฑุฉ ุงูุณููุงุช ุงูุฏุฑุงุณูุฉ
4. ุฌุฑูุจ ุญุฐู ุชูุฑูุฑ

### 5. ููุฒุงุช ุฅุถุงููุฉ ูููู ุชุทููุฑูุง:

#### ุฅุดุนุงุฑุงุช ุชููุงุฆูุฉ:
- ุฑูุน ุชูุฑูุฑ ูููู/ุฃุณุจูุนู/ุดูุฑู ุชููุงุฆูุงู
- ุฅุฑุณุงู ุฅุดุนุงุฑ ูููุฏุฑุงุก ุนูุฏ ุฑูุน ุชูุฑูุฑ ุฌุฏูุฏ

#### ุชุญูููุงุช ูุชูุฏูุฉ:
- ููุงุฑูุฉ ุงูุชูุงุฑูุฑ ุจูู ูุชุฑุงุช ูุฎุชููุฉ
- ุฑุณูู ุจูุงููุฉ ููุงุชุฌุงูุงุช
- ุชุตุฏูุฑ ุงูุชูุงุฑูุฑ ุจุตูุบ ูุฎุชููุฉ

#### ุตูุงุญูุงุช ูุชูุฏูุฉ:
- ุชุญุฏูุฏ ูู ููููู ุฑูุน ุงูุชูุงุฑูุฑ
- ุชุญุฏูุฏ ูู ููููู ุญุฐู ุงูุชูุงุฑูุฑ
- ุชุณุฌูู ุชุงุฑูุฎ ุฌููุน ุงูุนูููุงุช

## ุงุณุชุฎุฏุงู ูู ุชุทุจูู ุงููุฏุฑุงุก:

ูููู ูุชุทุจูู ุงููุฏุฑุงุก ุงูุขู:

1. **ุฌูุจ ุงูุชูุงุฑูุฑ**: ุงุณุชุฎุฏุงู `ReportsSupabaseService.getOrganizationReports()`
2. **ุนุฑุถ ุงูุฅุญุตุงุฆูุงุช**: ุงุณุชุฎุฏุงู `ReportsSupabaseService.getOrganizationStats()`
3. **ููุชุฑุฉ ุงูุจูุงูุงุช**: ุญุณุจ ุงูุณูุฉ ุงูุฏุฑุงุณูุฉ ุฃู ุงูุชุงุฑูุฎ
4. **ูุฑุงูุจุฉ ุงูุฃุฏุงุก**: ูุชุงุจุนุฉ ุงูุงุชุฌุงูุงุช ูุงูุชุบููุฑุงุช

## ุงูุฃูุงู ูุงูุตูุงุญูุงุช:

โ๏ธ **ููู**: ุชุฃูุฏ ูู ุฅุนุฏุงุฏ Row Level Security (RLS) ูู Supabase:

```sql
-- ุชูุนูู RLS ุนูู ุฌุฏูู ุงูุชูุงุฑูุฑ
ALTER TABLE school_reports ENABLE ROW LEVEL SECURITY;

-- ุณูุงุณุฉ ููุณูุงุญ ุจุงููุฑุงุกุฉ ูููุคุณุณุฉ ููุณูุง ููุท
CREATE POLICY "Users can view their organization reports" ON school_reports
    FOR SELECT USING (organization_id = auth.jwt() ->> 'organization_id');

-- ุณูุงุณุฉ ููุณูุงุญ ุจุงูุฅุฏุฑุงุฌ ูููุคุณุณุฉ ููุณูุง ููุท  
CREATE POLICY "Users can insert their organization reports" ON school_reports
    FOR INSERT WITH CHECK (organization_id = auth.jwt() ->> 'organization_id');
```

## ุงูุชุญูู ูู ูุฌุงุญ ุงูุชูููุฐ:

โ ุฅูุดุงุก ุฌุฏูู `school_reports` ูู Supabase  
โ ุฅุถุงูุฉ ุฎุฏูุฉ `ReportsSupabaseService`  
โ ุฅุถุงูุฉ ุดุงุดุฉ `UploadedReportsScreen`  
โ ุชุญุฏูุซ `ReportsScreen` ูุน ุฃุฒุฑุงุฑ ุงูุฑูุน ูุงูุนุฑุถ  
โ ุงุณุชุจุฏุงู ุงููุนุฑูุงุช ุงูุซุงุจุชุฉ ุจุงูููู ุงูุญููููุฉ  
โ ุงุฎุชุจุงุฑ ุฑูุน ูุนุฑุถ ุงูุชูุงุฑูุฑ  
โ ุฅุนุฏุงุฏ ุงูุตูุงุญูุงุช ูู Supabase  

---

๐ **ุชู! ุงููุธุงู ุฌุงูุฒ ูุฑูุน ูุงุณุชุฎุฏุงู ุงูุชูุงุฑูุฑ ูู ุชุทุจูู ุงููุฏุฑุงุก**
